##
## Strfry config for Noornote Local Relay
##

# Directory that contains the strfry LMDB database
db = "./strfry-db/"

dbParams {
  maxreaders = 256
  # ~10TB max DB size (should be enough for local testing)
  mapsize = 10995116277760
  noReadAhead = false
}

events {
  # Max event size: 64KB
  maxEventSize = 65536

  # Reject events with timestamps in future (15min tolerance)
  rejectEventsNewerThanSeconds = 900

  # Reject events older than ~3 years
  rejectEventsOlderThanSeconds = 94608000

  # Ephemeral events (kind 20000-29999)
  rejectEphemeralEventsOlderThanSeconds = 60
  ephemeralEventsLifetimeSeconds = 300

  # Limits per event
  maxNumTags = 2000
  maxTagValSize = 1024
}

relay {
  # Bind to all interfaces (accessible from host)
  bind = "0.0.0.0"
  port = 7777
  nofiles = 1000000

  # No reverse proxy header needed for local testing
  realIpHeader = ""

  info {
    name = "Noornote Local Relay"
    description = "Local strfry relay for Noornote development and testing"
    pubkey = ""
    contact = ""
    icon = ""
    nips = ""
  }

  # WebSocket settings
  maxWebsocketPayloadSize = 131072
  maxReqFilterSize = 200
  autoPingSeconds = 55
  enableTcpKeepalive = false

  # Query performance
  queryTimesliceBudgetMicroseconds = 10000
  maxFilterLimit = 500
  maxSubsPerConnection = 20

  # Write policy plugin (none for now - accept all events)
  writePolicy {
    plugin = ""
  }

  # Enable compression for better performance
  compression {
    enabled = true
    slidingWindow = true
  }

  # Logging (minimal for cleaner output)
  logging {
    dumpInAll = false
    dumpInEvents = false
    dumpInReqs = false
    dbScanPerf = false
    invalidEvents = true
  }

  # Thread pool configuration
  numThreads {
    ingester = 3
    reqWorker = 3
    reqMonitor = 3
    negentropy = 2
  }

  # Negentropy sync protocol (efficient set reconciliation)
  negentropy {
    enabled = true
    maxSyncEvents = 1000000
  }
}
